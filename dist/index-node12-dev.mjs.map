{"version":3,"file":"index-node12-dev.mjs","sources":["../src/utils/createReportError.ts","../src/checks/checkDirectDuplicateDependencies.ts","../src/checks/checkExactVersions.ts","../src/utils/object.ts","../src/checks/checkIdenticalVersions.ts","../src/checks/checkIdenticalVersionsThanDependency.ts","../src/checks/checkNoDependencies.ts","../src/checks/checkPeerDependencies.ts","../src/checks/checkResolutionsHasExplanation.ts","../src/checks/checkSatisfiesVersionsFromDependency.ts","../src/utils/createGetDependencyPackageJson.ts","../src/check-package.ts","../src/check-package-with-workspaces.ts"],"sourcesContent":["/* eslint-disable no-console */\n\nimport chalk from 'chalk';\n\nexport type ReportError = (\n  msgTitle: string,\n  msgInfo?: string,\n  onlyWarns?: boolean,\n) => void;\n\nlet titleDisplayed: string | null = null;\nlet pkgPathDisplayed: string | null = null;\n\nexport function logMessage(\n  msgTitle: string,\n  msgInfo?: string,\n  onlyWarns?: boolean,\n): void {\n  console.error(\n    `${\n      onlyWarns ? chalk.yellow(`⚠ ${msgTitle}`) : chalk.red(`❌ ${msgTitle}`)\n    }${msgInfo ? `: ${msgInfo}` : ''}`,\n  );\n}\n\nexport function createReportError(\n  title: string,\n  pkgPathName: string,\n): ReportError {\n  return function reportError(msgTitle, msgInfo, onlyWarns): void {\n    if (titleDisplayed !== title || pkgPathName !== pkgPathDisplayed) {\n      if (titleDisplayed) console.error();\n      console.error(chalk.cyan(`== ${title} in ${pkgPathName} ==`));\n      titleDisplayed = title;\n      pkgPathDisplayed = pkgPathName;\n    }\n    logMessage(msgTitle, msgInfo, onlyWarns);\n\n    if (!onlyWarns) {\n      // console.trace();\n      process.exitCode = 1;\n    }\n  };\n}\n","import { intersects } from 'semver';\nimport type { ReportError } from '../utils/createReportError';\nimport { createReportError } from '../utils/createReportError';\nimport type { PackageJson, DependencyTypes } from '../utils/packageTypes';\n\nexport function checkWarnedFor(\n  reportError: ReportError,\n  onlyWarnsFor: string[] = [],\n  warnedFor: Set<string>,\n): void {\n  onlyWarnsFor.forEach((depName) => {\n    if (!warnedFor.has(depName)) {\n      reportError(\n        `Invalid \"${depName}\" in \"onlyWarnsFor\" but no warning was raised`,\n      );\n    }\n  });\n}\n\nexport function checkDirectDuplicateDependencies(\n  pkg: PackageJson,\n  pkgPathName: string,\n  depType: DependencyTypes,\n  searchIn: DependencyTypes[],\n  depPkg: PackageJson,\n  onlyWarnsFor: string[] = [],\n  warnedForInternal?: Set<string>,\n): void {\n  const dependencies = depPkg[depType];\n  if (!dependencies) return;\n\n  const warnedFor = warnedForInternal || new Set<string>();\n\n  const reportError = createReportError(\n    'Direct Duplicate Dependencies',\n    pkgPathName,\n  );\n  const searchInExisting = searchIn.filter((type) => pkg[type]);\n\n  for (const [depKey, range] of Object.entries(dependencies)) {\n    const versionsIn = searchInExisting.filter(\n      (type) => (pkg[type] as NonNullable<typeof pkg[DependencyTypes]>)[depKey],\n    );\n\n    if (versionsIn.length > 1) {\n      reportError(\n        `${depKey} is present in both devDependencies and dependencies, please place it only in dependencies`,\n      );\n    } else {\n      const versions = versionsIn.map(\n        (type) =>\n          (pkg[type] as NonNullable<typeof pkg[DependencyTypes]>)[depKey],\n      );\n\n      versions.forEach((version, index) => {\n        if (version.startsWith('file:')) return;\n\n        if (intersects(version, range)) {\n          return;\n        }\n\n        // Ignore reporting duplicate when there's a resolution for it\n        if (pkg.resolutions?.[depKey]) {\n          return;\n        }\n\n        const versionInType = versionsIn[index];\n        const shouldWarns = onlyWarnsFor.includes(depKey);\n        if (shouldWarns) warnedFor.add(depKey);\n\n        reportError(\n          `Invalid duplicate dependency \"${depKey}\"`,\n          `\"${versions[0]}\" (in ${versionInType}) should satisfies \"${range}\" from \"${depPkg.name}\" ${depType}.`,\n          shouldWarns,\n        );\n      });\n    }\n  }\n\n  if (!warnedForInternal) {\n    checkWarnedFor(reportError, onlyWarnsFor, warnedFor);\n  }\n}\n","import { createReportError } from '../utils/createReportError';\nimport type { PackageJson, DependencyTypes } from '../utils/packageTypes';\n\nexport function checkExactVersions(\n  pkg: PackageJson,\n  pkgPathName: string,\n  type: DependencyTypes,\n): void {\n  const pkgDependencies = pkg[type];\n  if (!pkgDependencies) return;\n\n  const reportError = createReportError('Exact versions', pkgPathName);\n\n  for (const [depKey, version] of Object.entries(pkgDependencies)) {\n    if (version.startsWith('^') || version.startsWith('~')) {\n      reportError(\n        `Unexpected range dependency in \"${type}\" for \"${depKey}\"`,\n        `expecting \"${version}\" to be exact \"${version.slice(1)}\".`,\n      );\n      return;\n    }\n  }\n}\n","export const getKeys = <T>(o: T): (keyof T)[] => Object.keys(o) as (keyof T)[];\n","import { createReportError } from '../utils/createReportError';\nimport { getKeys } from '../utils/object';\nimport type { DependencyTypes, PackageJson } from '../utils/packageTypes';\n\nexport function checkIdenticalVersions(\n  pkg: PackageJson,\n  pkgPathName: string,\n  type: DependencyTypes,\n  deps: Record<string, string[]>,\n  onlyWarnsFor: string[] = [],\n): void {\n  const pkgDependencies = pkg[type] || {};\n  const reportError = createReportError('Identical Versions', pkgPathName);\n\n  getKeys(deps).forEach((depKey) => {\n    const version = pkgDependencies[depKey];\n    if (!version) {\n      reportError(`Unexpected missing ${type} for \"${depKey}\".`);\n      return;\n    }\n\n    deps[depKey].forEach((depKeyIdentical) => {\n      const value = pkgDependencies[depKeyIdentical];\n      if (!value) {\n        reportError(\n          `Missing \"${depKeyIdentical}\" in ${type}`,\n          `it should be \"${version}\".`,\n          onlyWarnsFor.includes(depKey),\n        );\n      }\n\n      if (value !== version) {\n        reportError(\n          `Invalid \"${depKeyIdentical}\" in ${type}`,\n          `expecting \"${value}\" be \"${version}\".`,\n          onlyWarnsFor.includes(depKey),\n        );\n      }\n    });\n  });\n}\n","import { createReportError } from '../utils/createReportError';\nimport type { PackageJson, DependencyTypes } from '../utils/packageTypes';\n\nexport function checkIdenticalVersionsThanDependency(\n  pkg: PackageJson,\n  pkgPathName: string,\n  type: DependencyTypes,\n  depKeys: string[],\n  depPkg: PackageJson,\n  dependencies: PackageJson[DependencyTypes] = {},\n  onlyWarnsFor: string[] = [],\n): void {\n  const pkgDependencies = pkg[type] || {};\n  const reportError = createReportError(\n    `Same Versions than ${depPkg.name}`,\n    pkgPathName,\n  );\n\n  depKeys.forEach((depKey) => {\n    const version = dependencies[depKey];\n    if (!version) {\n      reportError(\n        `Unexpected missing dependency version in \"${depPkg.name}\" for \"${depKey}\".`,\n      );\n      return;\n    }\n\n    if (version.startsWith('^') || version.startsWith('~')) {\n      reportError(\n        `Unexpected range dependency in \"${depPkg.name}\" for \"${depKey}\"`,\n        'perhaps use checkSatisfiesVersionsFromDependency() instead.',\n      );\n      return;\n    }\n\n    const value = pkgDependencies[depKey];\n\n    if (!value) {\n      reportError(\n        `Missing \"${depKey}\" in ${type}`,\n        `expecting to be \"${version}\".`,\n        onlyWarnsFor.includes(depKey),\n      );\n    }\n\n    if (value !== version) {\n      reportError(\n        `Invalid \"${depKey}\" in ${type}`,\n        `expecting \"${value}\" to be \"${version}\".`,\n        onlyWarnsFor.includes(depKey),\n      );\n    }\n  });\n}\n","import { createReportError } from '../utils/createReportError';\nimport type { PackageJson, DependencyTypes } from '../utils/packageTypes';\n\nexport function checkNoDependencies(\n  pkg: PackageJson,\n  pkgPath: string,\n  type: DependencyTypes = 'dependencies',\n  moveToSuggestion: DependencyTypes = 'devDependencies',\n): void {\n  const pkgDependencies = pkg[type];\n  if (!pkgDependencies) return;\n\n  const reportError = createReportError('No dependencies', pkgPath);\n  reportError(\n    `Unexpected ${type}`,\n    `you should move them in ${moveToSuggestion}`,\n  );\n}\n","import { satisfies, minVersion } from 'semver';\nimport { createReportError } from '../utils/createReportError';\nimport type { PackageJson, DependencyTypes } from '../utils/packageTypes';\n\nexport function checkPeerDependencies(\n  pkg: PackageJson,\n  pkgPathName: string,\n  type: DependencyTypes,\n  allowedPeerIn: DependencyTypes[],\n  depPkg: PackageJson,\n  onlyWarnsFor: string[] = [],\n): void {\n  const { peerDependencies, peerDependenciesMeta } = depPkg;\n  if (!peerDependencies) return;\n  const reportError = createReportError('Peer Dependencies', pkgPathName);\n\n  const allowedPeerInExisting = allowedPeerIn.filter((type) => pkg[type]);\n\n  for (const [peerDepKey, range] of Object.entries(peerDependencies)) {\n    const versionsIn = allowedPeerInExisting.filter(\n      (type) =>\n        (pkg[type] as NonNullable<typeof pkg[DependencyTypes]>)[peerDepKey],\n    );\n    if (versionsIn.length === 0) {\n      const peerDependenciesMetaPeerDep = peerDependenciesMeta?.[peerDepKey];\n      if (peerDependenciesMetaPeerDep?.optional) {\n        return;\n      }\n      reportError(\n        `Missing \"${peerDepKey}\" peer dependency from \"${depPkg.name}\" in ${type}`,\n        `it should satisfies \"${range}\"`,\n        onlyWarnsFor.includes(peerDepKey),\n      );\n    } else {\n      const versions = versionsIn.map(\n        (type) =>\n          (pkg[type] as NonNullable<typeof pkg[DependencyTypes]>)[peerDepKey],\n      );\n      if (versions.length > 1) {\n        reportError(\n          `${peerDepKey} is present in both devDependencies and dependencies`,\n          'place it only in dependencies',\n        );\n        return;\n      }\n\n      versions.forEach((version, index) => {\n        const minVersionOfVersion = minVersion(version);\n        if (!minVersionOfVersion || !satisfies(minVersionOfVersion, range)) {\n          reportError(\n            `Invalid \"${peerDepKey}\" peer dependency`,\n            `\"${version}\" (in ${allowedPeerInExisting[index]}) should satisfies \"${range}\" from \"${depPkg.name}\" ${type}`,\n            onlyWarnsFor.includes(peerDepKey),\n          );\n        }\n      });\n    }\n  }\n}\n","import type { GetDependencyPackageJson } from '../utils/createGetDependencyPackageJson';\nimport { createReportError } from '../utils/createReportError';\nimport type { PackageJson } from '../utils/packageTypes';\n\nexport type CheckResolutionMessage = (\n  depKey: string,\n  resolutionExplainedMessage: string,\n  checkMessageHelpers: {\n    getDependencyPackageJson: GetDependencyPackageJson;\n  },\n) => string | undefined;\n\nexport function checkResolutionsHasExplanation(\n  pkg: PackageJson,\n  pkgPathName: string,\n  checkMessage: CheckResolutionMessage,\n  getDependencyPackageJson: GetDependencyPackageJson,\n): void {\n  const pkgResolutions = pkg.resolutions || {};\n  const pkgResolutionsExplained = pkg.resolutionsExplained || {};\n  const reportError = createReportError(\n    'Resolutions has explanation',\n    pkgPathName,\n  );\n\n  Object.keys(pkgResolutions).forEach((depKey) => {\n    if (!pkgResolutionsExplained[depKey]) {\n      reportError(`Missing \"${depKey}\" in resolutionsExplained.`);\n    }\n  });\n\n  Object.keys(pkgResolutionsExplained).forEach((depKey) => {\n    if (!pkgResolutions[depKey]) {\n      reportError(\n        `Found \"${depKey}\" in resolutionsExplained but not in resolutions.`,\n      );\n    } else {\n      const error = checkMessage(depKey, pkgResolutionsExplained[depKey], {\n        getDependencyPackageJson,\n      });\n      if (error) {\n        reportError(\n          `Invalid message for \"${depKey}\" in resolutionsExplained`,\n          `${error}.`,\n        );\n      }\n    }\n  });\n}\n","import { satisfies, minVersion } from 'semver';\nimport { createReportError } from '../utils/createReportError';\nimport type { DependencyTypes, PackageJson } from '../utils/packageTypes';\n\nexport function checkSatisfiesVersionsFromDependency(\n  pkg: PackageJson,\n  pkgPathName: string,\n  type: DependencyTypes,\n  depKeys: string[],\n  depPkg: PackageJson,\n  dependencies: PackageJson[DependencyTypes] = {},\n  onlyWarnsFor: string[] = [],\n): void {\n  const pkgDependencies = pkg[type] || {};\n  const reportError = createReportError(\n    `Satisfies Versions from ${depPkg.name}`,\n    pkgPathName,\n  );\n\n  depKeys.forEach((depKey) => {\n    const range = dependencies[depKey];\n    if (!range) {\n      throw new Error(\n        `Unexpected missing dependency range in \"${depPkg.name}\" for \"${depKey}\".`,\n      );\n    }\n\n    const version = pkgDependencies[depKey];\n\n    if (!version) {\n      reportError(\n        `Missing \"${depKey}\" in ${type}`,\n        `should satisfies \"${range}\" from \"${depPkg.name}\" ${depKey}.`,\n        onlyWarnsFor.includes(depKey),\n      );\n    } else {\n      const minVersionOfVersion = minVersion(version);\n      if (!minVersionOfVersion || !satisfies(minVersionOfVersion, range)) {\n        reportError(\n          `Invalid \"${depKey}\" in ${type}`,\n          `\"${version}\" (in \"${depKey}\") should satisfies \"${range}\" from \"${depPkg.name}\" ${depKey}.`,\n          onlyWarnsFor.includes(depKey),\n        );\n      }\n    }\n  });\n}\n","import { readFileSync } from 'fs';\nimport type { PackageJson } from './packageTypes';\n\nexport type GetDependencyPackageJson = (pkgDepName: string) => PackageJson;\n\nexport function readPkgJson(packagePath: string): PackageJson {\n  return JSON.parse(readFileSync(packagePath, 'utf-8')) as PackageJson;\n}\n\ntype NodeModulesPackagePathCache = Map<string, PackageJson>;\n\ninterface CreateGetDependencyPackageJsonOptions {\n  pkgDirname: string;\n  nodeModulesPackagePathCache?: NodeModulesPackagePathCache;\n}\n\nexport function createGetDependencyPackageJson({\n  pkgDirname,\n  nodeModulesPackagePathCache = new Map<string, PackageJson>(),\n}: CreateGetDependencyPackageJsonOptions): GetDependencyPackageJson {\n  return (pkgDepName) => {\n    const existing = nodeModulesPackagePathCache.get(pkgDepName);\n    if (existing) return existing;\n    let pkg: PackageJson;\n    if (pkgDepName.startsWith('.')) {\n      const packagePath = `${pkgDirname}/${pkgDepName}/package.json`;\n      pkg = readPkgJson(packagePath);\n    } else {\n      try {\n        // eslint-disable-next-line import/no-dynamic-require, @typescript-eslint/no-unsafe-assignment\n        pkg = require(require.resolve(`${pkgDepName}/package.json`, {\n          paths: [pkgDirname],\n        }));\n      } catch (err) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        if (err.code !== 'ERR_PACKAGE_PATH_NOT_EXPORTED') {\n          throw err;\n        }\n\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        const match = / in (.*\\/package.json)$/.exec(err.message);\n\n        if (match) {\n          const [, matchPackageJson] = match;\n          pkg = readPkgJson(matchPackageJson);\n        } else {\n          throw err;\n        }\n      }\n    }\n    nodeModulesPackagePathCache.set(pkgDepName, pkg);\n    return pkg;\n  };\n}\n","/* eslint-disable max-lines */\nimport path from 'path';\nimport {\n  checkDirectDuplicateDependencies,\n  checkWarnedFor,\n} from './checks/checkDirectDuplicateDependencies';\nimport { checkExactVersions } from './checks/checkExactVersions';\nimport { checkIdenticalVersions } from './checks/checkIdenticalVersions';\nimport { checkIdenticalVersionsThanDependency } from './checks/checkIdenticalVersionsThanDependency';\nimport { checkNoDependencies } from './checks/checkNoDependencies';\nimport { checkPeerDependencies } from './checks/checkPeerDependencies';\nimport type { CheckResolutionMessage } from './checks/checkResolutionsHasExplanation';\nimport { checkResolutionsHasExplanation } from './checks/checkResolutionsHasExplanation';\nimport { checkSatisfiesVersionsFromDependency } from './checks/checkSatisfiesVersionsFromDependency';\nimport type { GetDependencyPackageJson } from './utils/createGetDependencyPackageJson';\nimport {\n  createGetDependencyPackageJson,\n  readPkgJson,\n} from './utils/createGetDependencyPackageJson';\nimport { createReportError } from './utils/createReportError';\nimport { getKeys } from './utils/object';\nimport type { DependencyTypes, PackageJson } from './utils/packageTypes';\n\nexport interface CheckDirectPeerDependenciesOptions {\n  isLibrary?: boolean;\n  onlyWarnsFor?: string[];\n}\n\nexport interface CheckDirectDuplicateDependenciesOptions {\n  onlyWarnsFor?: string[];\n  /** @internal */\n  internalWarnedForDuplicate?: Set<string>;\n}\n\nexport interface CheckRecommendedOptions {\n  isLibrary?: boolean;\n  peerDependenciesOnlyWarnsFor?: string[];\n  directDuplicateDependenciesOnlyWarnsFor?: string[];\n  checkResolutionMessage?: CheckResolutionMessage;\n  /** @internal */\n  internalWarnedForDuplicate?: Set<string>;\n}\n\nexport interface CheckPackageApi {\n  /** @internal */\n  pkg: PackageJson;\n  /** @internal */\n  pkgDirname: string;\n  /** @internal */\n  pkgPathName: string;\n  /** @internal */\n  getDependencyPackageJson: GetDependencyPackageJson;\n\n  checkExactVersions: () => CheckPackageApi;\n  checkExactVersionsForLibrary: () => CheckPackageApi;\n  checkExactDevVersions: () => CheckPackageApi;\n  checkNoDependencies: (\n    type?: DependencyTypes,\n    moveToSuggestion?: DependencyTypes,\n  ) => CheckPackageApi;\n  checkDirectPeerDependencies: (\n    options?: CheckDirectPeerDependenciesOptions,\n  ) => CheckPackageApi;\n  checkDirectDuplicateDependencies: (\n    options?: CheckDirectDuplicateDependenciesOptions,\n  ) => CheckPackageApi;\n  checkResolutionsHasExplanation: (\n    checkMessage?: CheckResolutionMessage,\n  ) => CheckPackageApi;\n  checkRecommended: (options?: CheckRecommendedOptions) => CheckPackageApi;\n  checkIdenticalVersionsThanDependency: (\n    depName: string,\n    dependencies: {\n      resolutions?: string[];\n      dependencies?: string[];\n      devDependencies?: string[];\n    },\n  ) => CheckPackageApi;\n  checkIdenticalVersionsThanDevDependencyOfDependency: (\n    depName: string,\n    dependencies: {\n      resolutions?: string[];\n      dependencies?: string[];\n      devDependencies?: string[];\n    },\n  ) => CheckPackageApi;\n  checkSatisfiesVersionsFromDependency: (\n    depName: string,\n    dependencies: {\n      resolutions?: string[];\n      dependencies?: string[];\n      devDependencies?: string[];\n    },\n  ) => CheckPackageApi;\n  checkSatisfiesVersionsInDevDependenciesOfDependency: (\n    depName: string,\n    dependencies: {\n      resolutions?: string[];\n      dependencies?: string[];\n      devDependencies?: string[];\n    },\n  ) => CheckPackageApi;\n  checkIdenticalVersions: (dependencies: {\n    resolutions?: Record<string, string[]>;\n    dependencies?: Record<string, string[]>;\n    devDependencies?: Record<string, string[]>;\n  }) => CheckPackageApi;\n}\n\nexport function createCheckPackage(pkgDirectoryPath = '.'): CheckPackageApi {\n  const pkgDirname = path.resolve(pkgDirectoryPath);\n  const pkgPath = `${pkgDirname}/package.json`;\n  const pkgPathName = `${pkgDirectoryPath}/package.json`;\n  const pkg = readPkgJson(pkgPath);\n\n  const getDependencyPackageJson = createGetDependencyPackageJson({\n    pkgDirname,\n  });\n\n  return {\n    pkg,\n    pkgDirname,\n    pkgPathName,\n    getDependencyPackageJson,\n    checkExactVersions() {\n      checkExactVersions(pkg, pkgPathName, 'dependencies');\n      checkExactVersions(pkg, pkgPathName, 'devDependencies');\n      checkExactVersions(pkg, pkgPathName, 'resolutions');\n      return this;\n    },\n    checkExactVersionsForLibrary() {\n      checkExactVersions(pkg, pkgPathName, 'devDependencies');\n      checkExactVersions(pkg, pkgPathName, 'resolutions');\n      return this;\n    },\n\n    checkExactDevVersions() {\n      checkExactVersions(pkg, pkgPathName, 'devDependencies');\n      return this;\n    },\n\n    checkNoDependencies(\n      type = 'dependencies',\n      moveToSuggestion = 'devDependencies',\n    ) {\n      checkNoDependencies(pkg, pkgPathName, type, moveToSuggestion);\n      return this;\n    },\n\n    checkDirectPeerDependencies({ isLibrary, onlyWarnsFor } = {}) {\n      const checks: {\n        type: DependencyTypes;\n        allowedPeerIn: DependencyTypes[];\n      }[] = [\n        {\n          type: 'devDependencies',\n          allowedPeerIn: ['devDependencies', 'dependencies'],\n        },\n        {\n          type: 'dependencies',\n          allowedPeerIn: isLibrary\n            ? ['devDependencies', 'dependencies']\n            : ['dependencies'],\n        },\n      ];\n      checks.forEach(({ type, allowedPeerIn }) => {\n        if (!pkg[type]) return;\n        getKeys(pkg[type]).forEach((depName) => {\n          const depPkg = getDependencyPackageJson(depName);\n          if (depPkg.peerDependencies) {\n            checkPeerDependencies(\n              pkg,\n              pkgPathName,\n              type,\n              allowedPeerIn,\n              depPkg,\n              onlyWarnsFor,\n            );\n          }\n          // TODO optionalPeerDependency\n        });\n      });\n      return this;\n    },\n\n    checkDirectDuplicateDependencies({\n      onlyWarnsFor,\n      internalWarnedForDuplicate,\n    } = {}) {\n      const warnedForInternal = internalWarnedForDuplicate || new Set();\n      const checks: {\n        type: DependencyTypes;\n        searchIn: DependencyTypes[];\n      }[] = [\n        {\n          type: 'devDependencies',\n          searchIn: ['devDependencies', 'dependencies'],\n        },\n        { type: 'dependencies', searchIn: ['devDependencies', 'dependencies'] },\n      ];\n      checks.forEach(({ type, searchIn }) => {\n        if (!pkg[type]) return;\n        getKeys(pkg[type]).forEach((depName) => {\n          const depPkg = getDependencyPackageJson(depName);\n          checkDirectDuplicateDependencies(\n            pkg,\n            pkgPathName,\n            'dependencies',\n            searchIn,\n            depPkg,\n            onlyWarnsFor,\n            warnedForInternal,\n          );\n        });\n      });\n\n      if (!warnedForInternal) {\n        const reportError = createReportError(\n          'Direct Duplicate Dependencies',\n          pkgPathName,\n        );\n        checkWarnedFor(reportError, onlyWarnsFor, warnedForInternal);\n      }\n      return this;\n    },\n\n    checkResolutionsHasExplanation(\n      checkMessage: CheckResolutionMessage = (depKey, message) => undefined,\n    ) {\n      checkResolutionsHasExplanation(\n        pkg,\n        pkgPathName,\n        checkMessage,\n        getDependencyPackageJson,\n      );\n      return this;\n    },\n\n    checkRecommended({\n      isLibrary = false,\n      peerDependenciesOnlyWarnsFor,\n      directDuplicateDependenciesOnlyWarnsFor,\n      checkResolutionMessage,\n      internalWarnedForDuplicate,\n    } = {}) {\n      if (isLibrary) {\n        this.checkExactVersionsForLibrary();\n      } else {\n        this.checkExactVersions();\n      }\n\n      this.checkDirectPeerDependencies({\n        isLibrary,\n        onlyWarnsFor: peerDependenciesOnlyWarnsFor,\n      });\n\n      this.checkDirectDuplicateDependencies({\n        onlyWarnsFor: directDuplicateDependenciesOnlyWarnsFor,\n        internalWarnedForDuplicate,\n      });\n\n      this.checkResolutionsHasExplanation(checkResolutionMessage);\n      return this;\n    },\n\n    checkIdenticalVersionsThanDependency(\n      depName,\n      { resolutions, dependencies, devDependencies },\n    ) {\n      const depPkg = getDependencyPackageJson(depName);\n      if (resolutions) {\n        checkIdenticalVersionsThanDependency(\n          pkg,\n          pkgPathName,\n          'resolutions',\n          resolutions,\n          depPkg,\n          depPkg.dependencies,\n        );\n      }\n      if (dependencies) {\n        checkIdenticalVersionsThanDependency(\n          pkg,\n          pkgPathName,\n          'dependencies',\n          dependencies,\n          depPkg,\n          depPkg.dependencies,\n        );\n      }\n      if (devDependencies) {\n        checkIdenticalVersionsThanDependency(\n          pkg,\n          pkgPathName,\n          'devDependencies',\n          devDependencies,\n          depPkg,\n          depPkg.dependencies,\n        );\n      }\n      return this;\n    },\n\n    checkIdenticalVersionsThanDevDependencyOfDependency(\n      depName,\n      { resolutions, dependencies, devDependencies },\n    ) {\n      const depPkg = getDependencyPackageJson(depName);\n      if (resolutions) {\n        checkIdenticalVersionsThanDependency(\n          pkg,\n          pkgPathName,\n          'resolutions',\n          resolutions,\n          depPkg,\n          depPkg.devDependencies,\n        );\n      }\n      if (dependencies) {\n        checkIdenticalVersionsThanDependency(\n          pkg,\n          pkgPathName,\n          'dependencies',\n          dependencies,\n          depPkg,\n          depPkg.devDependencies,\n        );\n      }\n      if (devDependencies) {\n        checkIdenticalVersionsThanDependency(\n          pkg,\n          pkgPathName,\n          'devDependencies',\n          devDependencies,\n          depPkg,\n          depPkg.devDependencies,\n        );\n      }\n      return this;\n    },\n\n    checkSatisfiesVersionsFromDependency(\n      depName,\n      { resolutions, dependencies, devDependencies },\n    ) {\n      const depPkg = getDependencyPackageJson(depName);\n      if (resolutions) {\n        checkSatisfiesVersionsFromDependency(\n          pkg,\n          pkgPathName,\n          'resolutions',\n          resolutions,\n          depPkg,\n          depPkg.dependencies,\n        );\n      }\n      if (dependencies) {\n        checkSatisfiesVersionsFromDependency(\n          pkg,\n          pkgPathName,\n          'dependencies',\n          dependencies,\n          depPkg,\n          depPkg.dependencies,\n        );\n      }\n      if (devDependencies) {\n        checkSatisfiesVersionsFromDependency(\n          pkg,\n          pkgPathName,\n          'devDependencies',\n          devDependencies,\n          depPkg,\n          depPkg.dependencies,\n        );\n      }\n      return this;\n    },\n\n    checkSatisfiesVersionsInDevDependenciesOfDependency(\n      depName,\n      { resolutions, dependencies, devDependencies },\n    ) {\n      const depPkg = getDependencyPackageJson(depName);\n      if (resolutions) {\n        checkSatisfiesVersionsFromDependency(\n          pkg,\n          pkgPathName,\n          'resolutions',\n          resolutions,\n          depPkg,\n          depPkg.devDependencies,\n        );\n      }\n      if (dependencies) {\n        checkSatisfiesVersionsFromDependency(\n          pkg,\n          pkgPathName,\n          'dependencies',\n          dependencies,\n          depPkg,\n          depPkg.devDependencies,\n        );\n      }\n      if (devDependencies) {\n        checkSatisfiesVersionsFromDependency(\n          pkg,\n          pkgPathName,\n          'devDependencies',\n          devDependencies,\n          depPkg,\n          depPkg.devDependencies,\n        );\n      }\n      return this;\n    },\n\n    checkIdenticalVersions({ resolutions, dependencies, devDependencies }) {\n      if (resolutions) {\n        checkIdenticalVersions(pkg, pkgPathName, 'resolutions', resolutions);\n      }\n      if (dependencies) {\n        checkIdenticalVersions(pkg, pkgPathName, 'dependencies', dependencies);\n      }\n      if (devDependencies) {\n        checkIdenticalVersions(\n          pkg,\n          pkgPathName,\n          'devDependencies',\n          devDependencies,\n        );\n      }\n      return this;\n    },\n  };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport glob from 'glob';\nimport type { CheckPackageApi } from './check-package';\nimport { createCheckPackage } from './check-package';\nimport {\n  checkDirectDuplicateDependencies,\n  checkWarnedFor,\n} from './checks/checkDirectDuplicateDependencies';\nimport type { CheckResolutionMessage } from './checks/checkResolutionsHasExplanation';\nimport { readPkgJson } from './utils/createGetDependencyPackageJson';\nimport { createReportError } from './utils/createReportError';\nimport type { PackageJson } from './utils/packageTypes';\n\nexport interface CheckPackageWithWorkspacesRecommendedOptions {\n  isLibrary?: (pkgName: string) => boolean;\n  peerDependenciesOnlyWarnsFor?: string[];\n  directDuplicateDependenciesOnlyWarnsFor?: string[];\n  checkResolutionMessage?: CheckResolutionMessage;\n}\n\nexport interface CheckPackageWithWorkspacesApi {\n  checkRecommended: (\n    options?: CheckPackageWithWorkspacesRecommendedOptions,\n  ) => CheckPackageWithWorkspacesApi;\n\n  forRoot: (\n    callback: (checkPackage: CheckPackageApi) => void,\n  ) => CheckPackageWithWorkspacesApi;\n  for: (\n    id: string,\n    callback: (checkPackage: CheckPackageApi) => void,\n  ) => CheckPackageWithWorkspacesApi;\n}\n\nexport function createCheckPackageWithWorkspaces(\n  pkgDirectoryPath = '.',\n): CheckPackageWithWorkspacesApi {\n  const checkPackage = createCheckPackage(pkgDirectoryPath);\n  const { pkg, pkgDirname, pkgPathName } = checkPackage;\n\n  const pkgWorkspaces: undefined | string[] =\n    pkg.workspaces && !Array.isArray(pkg.workspaces)\n      ? pkg.workspaces.packages\n      : pkg.workspaces;\n\n  if (!pkgWorkspaces) {\n    throw new Error('Package is missing \"workspaces\"');\n  }\n\n  const workspaces: {\n    id: string;\n    pkgDirname: string;\n    pkgDirectoryPath: string;\n    pkgPath: string;\n    pkg: PackageJson;\n  }[] = [];\n\n  if (pkgWorkspaces) {\n    pkgWorkspaces.forEach((pattern) => {\n      const match = glob.sync(`${pkgDirname}/${pattern}`);\n      match.forEach((pathMatch) => {\n        const stat = fs.statSync(pathMatch);\n        if (!stat.isDirectory()) return;\n        const pkgDirectoryPath = path.relative(process.cwd(), pathMatch);\n        const pkgPath = path.join(pkgDirectoryPath, 'package.json');\n        const pkg = readPkgJson(pkgPath);\n        workspaces.push({\n          id: pkg.name,\n          pkgDirname: pathMatch,\n          pkgDirectoryPath,\n          pkgPath,\n          pkg,\n        });\n      });\n    });\n  }\n\n  const checksWorkspaces = new Map<string, CheckPackageApi>(\n    workspaces.map(({ id, pkgDirectoryPath }) => [\n      id,\n      createCheckPackage(pkgDirectoryPath),\n    ]),\n  );\n\n  return {\n    checkRecommended({\n      isLibrary = () => false,\n      peerDependenciesOnlyWarnsFor,\n      directDuplicateDependenciesOnlyWarnsFor,\n      checkResolutionMessage,\n    } = {}) {\n      checkPackage.checkNoDependencies();\n      checkPackage.checkRecommended({\n        isLibrary: false,\n        peerDependenciesOnlyWarnsFor,\n        directDuplicateDependenciesOnlyWarnsFor,\n        checkResolutionMessage,\n      });\n\n      const warnedForDuplicate = new Set<string>();\n      checksWorkspaces.forEach((checkPackage, id) => {\n        checkPackage.checkRecommended({\n          isLibrary: isLibrary(id),\n          peerDependenciesOnlyWarnsFor,\n          directDuplicateDependenciesOnlyWarnsFor,\n          checkResolutionMessage,\n          internalWarnedForDuplicate: warnedForDuplicate,\n        });\n        checkDirectDuplicateDependencies(\n          pkg,\n          pkgPathName,\n          'devDependencies',\n          ['devDependencies', 'dependencies'],\n          pkg,\n          [],\n          warnedForDuplicate,\n        );\n      });\n\n      checkWarnedFor(\n        createReportError('Recommended Checks', pkgPathName),\n        directDuplicateDependenciesOnlyWarnsFor,\n        warnedForDuplicate,\n      );\n\n      return this;\n    },\n\n    forRoot(callback) {\n      callback(checkPackage);\n      return this;\n    },\n\n    for(id, callback) {\n      const packageCheck = checksWorkspaces.get(id);\n      if (!packageCheck) {\n        throw new Error(\n          `Invalid package name: ${id}. Known package names: \"${[\n            ...checksWorkspaces.keys(),\n          ].join('\",\"')}\"`,\n        );\n      }\n      callback(packageCheck);\n      return this;\n    },\n  };\n}\n"],"names":["titleDisplayed","pkgPathDisplayed","logMessage","msgTitle","msgInfo","onlyWarns","console","error","chalk","yellow","red","createReportError","title","pkgPathName","reportError","cyan","process","exitCode","checkWarnedFor","onlyWarnsFor","warnedFor","forEach","depName","has","checkDirectDuplicateDependencies","pkg","depType","searchIn","depPkg","warnedForInternal","dependencies","Set","searchInExisting","filter","type","depKey","range","Object","entries","versionsIn","length","versions","map","version","index","startsWith","intersects","resolutions","versionInType","shouldWarns","includes","add","name","checkExactVersions","pkgDependencies","slice","getKeys","o","keys","checkIdenticalVersions","deps","depKeyIdentical","value","checkIdenticalVersionsThanDependency","depKeys","checkNoDependencies","pkgPath","moveToSuggestion","checkPeerDependencies","allowedPeerIn","peerDependencies","peerDependenciesMeta","allowedPeerInExisting","peerDepKey","peerDependenciesMetaPeerDep","optional","minVersionOfVersion","minVersion","satisfies","checkResolutionsHasExplanation","checkMessage","getDependencyPackageJson","pkgResolutions","pkgResolutionsExplained","resolutionsExplained","checkSatisfiesVersionsFromDependency","Error","readPkgJson","packagePath","JSON","parse","readFileSync","createGetDependencyPackageJson","pkgDirname","nodeModulesPackagePathCache","Map","pkgDepName","existing","get","require","resolve","paths","err","code","match","exec","message","matchPackageJson","set","createCheckPackage","pkgDirectoryPath","path","checkExactVersionsForLibrary","checkExactDevVersions","checkDirectPeerDependencies","isLibrary","checks","internalWarnedForDuplicate","undefined","checkRecommended","peerDependenciesOnlyWarnsFor","directDuplicateDependenciesOnlyWarnsFor","checkResolutionMessage","devDependencies","checkIdenticalVersionsThanDevDependencyOfDependency","checkSatisfiesVersionsInDevDependenciesOfDependency","createCheckPackageWithWorkspaces","checkPackage","pkgWorkspaces","workspaces","Array","isArray","packages","pattern","glob","sync","pathMatch","stat","fs","statSync","isDirectory","relative","cwd","join","push","id","checksWorkspaces","warnedForDuplicate","forRoot","callback","for","packageCheck"],"mappings":"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"}